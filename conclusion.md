# まとめ

API設計に大事なことのまとめです。

## セキュリティ

ありとあらゆる攻撃を考慮しないといけません。

ユーザの環境も様々です。
APIを提供する側はそれらを制限することなんてできません。
クライアントに正しいも間違っているもありません。
不正な攻撃であろうと全てのリクエストは平等に扱われてしまうことを忘れてはいけません。

とにかく想像力が必要です。
人間は全員犯罪者で、ありとあらゆる手段を使って攻撃をしてきます。
セキュリティを考えるときは、**自分ならどうやって攻撃するか**を延々考えます。
単純にシステム上のやりとりだけではありません。
**ソーシャルハック**もかなり有効な攻撃手段です。
他のサービスの情報と組み合わせた攻撃も有効です。
本当に穴はないですか?
XSSのように機械的に検出できるようなものではありません。
複雑なシステムの一つ一つは小さな穴でも、組み合わせたら大きな穴になることもあります。
本当に穴はないですか?

APIの提供は必ずHTTPSを使いましょう。
今どきはAPIだけでなく全てのWebアクセスをHTTPSにするべきです。
Google大先生に倣いましょう。

APIレスポンスの内容には十分注意をはらいましょう。
余計な情報から実装が透けて見える場合があります。
他人が知ってはいけない情報を絶対に流してはいけません。
「自分のじゃない場合の個人情報はクライアントアプリで無視する」みたいな実装を提案してくるバカがいます。
死ねばいいと思います。

そして何より、**不要な個人情報を知ろうとしない**のがもっとも効果的です。
OAuthを使えばパスワードなんか知る必要はありません。
パスワードがなければリスト型攻撃も怖くありません。
住所や電話番号を知る必要があるサービスなんてごく一部です。
知る必要のない情報は知るべきではない、というスタンスを貫くと身軽になります。

## RESTful

世の中猫も杓子もRESTfulなのでRESTfulにしましょう。
この業界、長いものに巻かれるのは大正義です。
ついでに認証の方法はOAuthにしましょう@<fn>{rfc6750}。

//footnote[rfc6750][[http://tools.ietf.org/html/rfc6750]()]

モノをリソースとして捉え、その操作をHTTPメソッドに割り当てます。
制約を与えることで設計に統一感が出て、表現力が高まります。
当然ですがHTTPメソッドを正しく使いましょう。
GETは必ず冪等性を保証しなければいけません。

HTTPステータスコードも正しく使いましょう。
失敗しているのに `200` で返してはいけません。
JSONの中の `success` で判断しろなんてAPIはクソです。

最初はリソースの設計も難しいでしょう。
とことん考え、議論することが重要です。
仕事では1つのURIを決めるのに3日議論したこともあります。
それだけ名前をつけるというのは重要な行為です。

## JSON

大前提として、APIレスポンスとしてのJSONは**人間が読むもの**です。
人間がもっとも理解しやすいデータ構造にするべきです。
ただデータサイズとトレードオフな部分もあるので、
本当に必要であればサイズに最適化する場合もあります。

とにかくすべてのキー名を熟考しましょう。
全く初見でも意味が理解できるキー名になってますか?
きちんとした英単語を使いましょう。
絶対に単語を省略してはいけません。
複数のものならきちんと複数形を、
状態を表す場合は形容詞がふさわしいかそれとも過去分詞かよく考えましょう。
英語力はかなり必要です。
というかエンジニアに一番必要なものは間違いなく英語力なので英語の勉強は必ずしましょう。

## まとめのまとめ

3つに共通することは**とにかく考えること**です。
最近は言語やフレームワークの発達で**実装に掛かる時間は大きく短縮**しています。
その分とことん深く長く考えることができます@<fn>{not-enough}。

機能が正しく動くのは当たり前のことです。
今の時代、動けば良いなんて考えは通用しません。
理解しやすいか、保守しやすいか、拡張しやすいか、
ひっくるめて如何によい設計か、というところが求められます。
どれだけアタマと時間を使ったかがAPI設計の良し悪しを決めると思います。

//footnote[not-enough][もし今でも実装に手一杯というなら言語やフレームワークの選択が間違っているのか もしくは才能がないのでエンジニア辞めたほうがいいです]
